[build]
# Nixpacks builder (Railpack is newer but Nixpacks is stable for Python)
builder = "NIXPACKS"
nixpacksConfigPath = "nixpacks.toml"

[deploy]
# Run migrations before each deployment
preDeployCommand = "python manage.py migrate --noinput"

# Start command for web service (can be overridden per-service in Railway dashboard)
startCommand = "gunicorn ATProject.wsgi:application --bind 0.0.0.0:$PORT --workers 2 --threads 4 --worker-class gthread --timeout 120 --keep-alive 5 --max-requests 1000 --max-requests-jitter 100"

# Health check endpoint
healthcheckPath = "/health/"
healthcheckTimeout = 300

# Restart on failure with limited retries
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3
