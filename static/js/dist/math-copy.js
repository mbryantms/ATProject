(()=>{function s(e){let o=document.createRange();o.selectNodeContents(e);let t=window.getSelection();t.removeAllRanges(),t.addRange(o)}r(()=>{document.body.append(i("SPAN",{id:"scratchpad"}))});function i(e,o={}){let t=document.createElement(e);for(let[c,n]of Object.entries(o))t.setAttribute(c,n);return t}function r(e){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()}r(()=>{document.addEventListener("click",function(e){let o=e.target.closest(".block-button-bar button.copy");o&&(e.preventDefault(),e.stopPropagation(),d(o))},!0)});function d(e){let o=e.getAttribute("title"),t=o.match(/Copy LaTeX source of this equation to clipboard:\s*([\s\S]*)$/);if(!t){console.error("Could not extract LaTeX source from button title:",o);return}let c=t[1].replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").trim();navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(c).then(()=>{l(e)}).catch(n=>{console.error("Failed to copy LaTeX source:",n),a(c,e)}):a(c,e)}function a(e,o){let t=document.querySelector("#scratchpad");if(!t){console.error("Scratchpad element not found for fallback copy");return}t.innerText=e,s(t);try{document.execCommand("copy")?l(o):console.error("Copy command was unsuccessful")}catch(c){console.error("Failed to copy LaTeX source:",c)}t.innerText=""}function l(e){let o=e.closest(".math.display, .math.block");if(!o)return;let t=o.querySelector('mjx-container[display="true"]');t&&(t.classList.add("flash"),setTimeout(()=>{t.classList.remove("flash")},150))}})();
